# Madlen Telegram Mini App

Мини-приложение в Telegram для сотрудников компании с интеграцией с 1С. Позволяет просматривать данные о продажах, получать уведомления и запускать обработки в 1С.

## Функциональность

1. **Главная страница**:
   - Приветствие и кнопки перехода в разделы

2. **Раздел "Продажи"**:
   - Получение и отображение данных о продажах из 1С
   - Фильтрация по магазинам или складам
   - Графики продаж

3. **Раздел "Уведомления"**:
   - Уведомления по категориям: изменения цен, остатки, возвраты, план продаж
   - Уведомления подтягиваются с backend-сервиса

4. **Раздел "Обработки"**:
   - Запуск процессов в 1С
   - Генерация отчетов

5. **Аутентификация**:
   - Аутентификация сотрудников через Telegram ID
   - Разграничение прав (сотрудник, менеджер, администратор)

## Технический стек

### Backend:
- FastAPI
- PostgreSQL
- Redis (для кэширования)
- JWT для аутентификации

### Frontend:
- HTML + JavaScript
- Tailwind CSS
- Chart.js (для графиков)

### Интеграция с 1С:
- HTTP-сервис в 1С для обмена данными
- Опционально FTP/SFTP для передачи файлов

## Установка и запуск

1. **Клонирование репозитория**:
   ```bash
   git clone https://github.com/Rus9136/madlen_mini_app.git
   cd madlen_mini_app
   ```

2. **Настройка переменных окружения**:
   ```bash
   cp .env.example .env
   # Отредактируйте .env файл, указав свои значения
   ```

3. **Запуск с помощью Docker Compose**:
   ```bash
   docker-compose up -d
   ```

4. **Быстрый запуск с использованием скрипта**:
   ```bash
   chmod +x restart_full.sh
   ./restart_full.sh
   ```

5. **Проверка работоспособности**:
   - Локальная версия: http://localhost:8080/local.html
   - API документация: http://localhost:8001/docs

## Структура проекта

```
telegram-mini-app/
├── backend/               # Бэкенд на FastAPI
│   ├── alembic/           # Миграции базы данных
│   ├── app/               # Код приложения
│   │   ├── api/           # Эндпоинты API
│   │   ├── core/          # Ядро приложения
│   │   ├── db/            # Работа с базой данных
│   │   ├── models/        # ORM модели
│   │   ├── schemas/       # Pydantic схемы
│   │   ├── services/      # Бизнес-логика
│   │   └── main.py        # Точка входа
│   ├── scripts/           # Полезные скрипты
│   ├── Dockerfile         # Dockerfile для бэкенда
│   └── requirements.txt   # Зависимости Python
│
├── frontend/              # Фронтенд для Telegram Mini App
│   ├── js/                # JavaScript код
│   │   ├── components/    # UI компоненты
│   │   ├── pages/         # Страницы приложения
│   │   ├── services/      # Сервисы (API, Auth)
│   │   └── main.js        # Основной JS файл
│   ├── index.html         # Главная HTML страница для Telegram
│   └── local.html         # HTML страница для локальной разработки
│
├── nginx/                 # Конфигурация Nginx
│   └── nginx.conf         # Конфигурационный файл
│
├── docker-compose.yml     # Docker Compose конфигурация
├── restart_full.sh        # Скрипт для перезапуска
├── .env.example           # Пример файла переменных окружения
└── README.md              # Документация
```

## Интеграция с 1С

Для интеграции с 1С необходимо настроить HTTP-сервис на стороне 1С, который будет обрабатывать запросы от API.

## Разработка

Для локальной разработки используйте файл `local.html`, который позволяет тестировать приложение без необходимости запуска в Telegram.
